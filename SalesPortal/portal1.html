<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaderboard Portal — Admin</title>
<style>
  body{
    font-family:'Inter', sans-serif;
    background:#0b1020;
    color:#e6eef8;
    padding:20px;
  }
  h1{color:#ffcc00;}
  input, button{padding:8px;margin:4px;border-radius:6px;border:none;font-size:14px;}
  input{width:200px;}
  button{background:#ffcc00;color:#0b1020;font-weight:600;cursor:pointer;transition:0.2s;}
  button:hover{opacity:0.85;}
  .entry{
    display:flex;justify-content:space-between;align-items:center;
    padding:6px;margin:4px 0;
    background:#111827;border-radius:6px;cursor:pointer;
    transition:0.2s;
  }
  .entry:hover{background:#1f2937;}
  .entry button{background:#ff4444;color:#fff;font-size:12px;padding:2px 6px;margin-left:8px;}
</style>
</head>
<body>
<h1>Leaderboard Admin Portal</h1>

<label>Name: <input id="name" placeholder="Driver name"></label>
<label>Earnings (AED): <input id="earn" type="number" placeholder="0.00" min="0" step="0.01"></label>
<button id="addBtn">Add / Update</button>

<h2>Search / Current Entries</h2>
<input id="search" placeholder="Search name...">
<div id="board"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbw5ZXWkh7MJR0J0CHC55WWZ57d83MCFrTjFqRjfwaCkNzSSfMHofUJ73rXWAjDBcyks/exec'; // replace with your Apps Script URL

const nameEl = document.getElementById('name');
const earnEl = document.getElementById('earn');
const addBtn = document.getElementById('addBtn');
const board = document.getElementById('board');
const search = document.getElementById('search');

let currentData = [];

async function loadData(){
  const res = await fetch(API_URL);
  const data = await res.json();
  currentData = data;
  render(data);
}

function formatCurrency(n){ 
  return new Intl.NumberFormat('en-AE',{style:'currency',currency:'AED'}).format(n); 
}

function render(data){
  const q = search.value.toLowerCase();
  board.innerHTML = '';
  data.filter(d=>d.name.toLowerCase().includes(q))
      .sort((a,b)=>b.earn - a.earn)
      .forEach((d,i)=>{
        const div = document.createElement('div');
        div.className='entry';
        div.innerHTML = `#${i+1} ${d.name} — ${formatCurrency(d.earn)}`;

        // click to edit
        div.addEventListener('click', ()=>{
          nameEl.value = d.name;
          earnEl.value = d.earn;
        });

        // delete button
        const delBtn = document.createElement('button');
        delBtn.textContent='Delete';
        delBtn.addEventListener('click', async (e)=>{
          e.stopPropagation(); // prevent edit
          if(!confirm(`Delete ${d.name}?`)) return;
          const res = await fetch(API_URL,{
            method:'POST',
            body: JSON.stringify({delete:true, name:d.name})
          });
          alert(await res.text());
          loadData();
        });
        div.appendChild(delBtn);

        board.appendChild(div);
      });
}

addBtn.addEventListener('click', async ()=>{
  const name = nameEl.value.trim();
  const earn = parseFloat(earnEl.value) || 0;
  if(!name){ alert('Enter a name'); return; }

  const res = await fetch(API_URL,{
    method:'POST',
    body: JSON.stringify({name, earn})
  });
  const msg = await res.text();
  alert(msg);
  nameEl.value=''; earnEl.value='';
  loadData();
});

search.addEventListener('input', ()=>render(currentData));

loadData();
</script>
</body>
</html>
